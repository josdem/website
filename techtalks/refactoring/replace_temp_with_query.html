<!DOCTYPE html>
<html>
<head>
  <title>josdem.io : Refactoring - Replace temp with query</title>
  <link rel="icon" type="image/png" href="../../jmetadata-16px.png"/>

  <meta name=viewport content="width=device-width, initial-scale=1">
  <meta name="description" content="Refactoring Remplace Temp With Query">
  <meta name="author" content="josdem">
  <meta name="keywords" content="Refactor,Refactoring,josdem,Remplace temp with query">
  <meta charset="UTF-8">

  <link rel="stylesheet" href="../../css/josdem.css" type="text/css">

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-25685398-3', 'auto');
  ga('send', 'pageview');
  </script>
</head>

<body>
<div itemscope itemtype ="http://schema.org/CreativeWork">
  <h1 itemprop="name">Replace Temp With Query</h1>
  <p itemprop="description">You are using temporary variable to hold the result of an expression.<br/>
Extract the expression into a method. Replace all the references to the temp with the new method. The new method can then be used then  in other methods.</p>
  <div style="display:none">
    <span itemprop="dateCreated">2015-03-07</span>
    <span itemprop="genre">Refactoring</span>
    <span itemprop="educationalUse">Tech Talks</span>
    <span itemprop="keywords">Refactoring, josdem, Refactor, remplace temp with query, temp variables</span>	
  </div>
</div>
<p>The problem with temps is that they are temporary and local. Because they can be seen only in the context of the method in wich they are used, temps tend to encourage longer methods, because that's the only way you can reach the temp. By replacing the temp with query method, any method in the class can get at the information. That helps a lot in coming up with cleaner code for the class.</p>
Consider the following class:
<br/><br/>
<code>
<span style="color: #7F0055; font-weight: bold;"> package </span> com.josdem.refactoring;
<br/><br/>
<span style="color: #7F0055; font-weight: bold;"> public class </span> DiscountCalculator {
<br/><br/>
&nbsp;&nbsp;<span style="color: #7F0055; font-weight: bold;"> public </span> Double getTotal(Integer <span style="color: #646464;">quantity</span>, Integer <span style="color: #646464;">itemPrice</span>) {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Integer basePrice = <span style="color: #646464;">quantity</span> * <span style="color: #646464;">itemPrice</span>;
<br/><br/>
&nbsp;&nbsp;&nbsp;&nbsp;Double = <span style="color: #646464;">discountFactor</span>;
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #7F0055; font-weight: bold;">if </span>(<span style="color: #646464;">basePrice</span> > 1000) {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #646464;">discountFactor</span> * 0.95;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<span style="color: #7F0055; font-weight: bold;"> else </span>{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #646464;">discountFactor</span> * 0.98;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #7F0055; font-weight: bold;">return </span><span style="color: #646464;">basePrice</span> * </span><span style="color: #646464;">discountFactor</span>; <br/>
<br/>
}
<br/><br/>
</code>
First I replace the right-hand side of the assignment:
<br/><br/>
<code>
Integer basePrice = <b>getBasePrice()</b>;
</code>
<br/><br/>
Then I replace all references to that temp with the expression.
<br/><br/>
<code>
<span style="color: #7F0055; font-weight: bold;"> public </span> Double getTotal() {<br/>
&nbsp;&nbsp;Double = <span style="color: #646464;">discountFactor</span>;
<br/>
&nbsp;&nbsp;<span style="color: #7F0055; font-weight: bold;">if </span>(<span style="color: #646464;">getBasePrice()</span> > 1000) {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #646464;">discountFactor</span> * 0.95;<br/>
&nbsp;&nbsp;}<span style="color: #7F0055; font-weight: bold;"> else </span>{<br/>
&nbsp;&nbsp;&nbsp;<span style="color: #646464;">discountFactor</span> * 0.98;<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span style="color: #7F0055; font-weight: bold;">return </span><span style="color: #646464;">getBasePrice()</span> * </span><span style="color: #646464;">discountFactor</span>; <br/>
}
<br/><br/>
<span style="color: #7F0055; font-weight: bold;">private </span>Integer getBasePrice() {<br/>
&nbsp;&nbsp;<span style="color: #7F0055; font-weight: bold;">return </span><span style="color: #0000C0;">quantity</span> * </span><span style="color: #0000C0;">itemPrice</span>; <br/>
}
</code>
<br/><br/>
With that done I can extract discountFactor in a similar way.
<br/><br/>
<code>
<span style="color: #7F0055; font-weight: bold;">private </span>Integer getDiscountFactor() {<br/>
&nbsp;&nbsp;<span style="color: #7F0055; font-weight: bold;">return </span>(getBasePrice() > 1000) ? 0.95 : 0.98;<br/>
}
</code>
<br/><br/>
See how it would have been difficult to extract discountFactor if I had not replaced basePrice with a query.<br/>
The getPrice method ends up as follow.
<br/><br/>
<code>
<span style="color: #7F0055; font-weight: bold;">private </span>Double getTotal() {<br/>
&nbsp;&nbsp;<span style="color: #7F0055; font-weight: bold;">return </span>getBasePrice() * getDiscountFactor();<br/>
}
</code>
<br/><br/>
<i>
When I'm working on a method, I like to replace temp with query to get rid of any temporary variables that I can remove. If the temp is used for many things, I use split temporary variable first to make the temp easier to replace. ~ Martin Fowler.
</i>
<br/><br/>
Read more, returning to the main article. <a href="../refactoring.html">Refactoring</a>
<br/><br/>
<footer>
<!-- TWITTER SHARE BUTTON -->
<ul class="footer_ul">
<li class="footer_li">
<a href="https://twitter.com/share" class="twitter-share-button" data-url="http://josdem.io/techtalks/refactoring/replace_temp_with_query.html" data-via="josdem" data-hashtags="Refactoring">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
</li>

<!-- GOOGLE PLUS SHARE BUTTON -->
<li class="footer_li">
<script src="https://apis.google.com/js/platform.js" async defer></script>
<div class="g-plus" data-action="share" data-height="24"></div>
</li>
</footer>
</body>
</html>
