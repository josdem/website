<!DOCTYPE html>
<html>
<head>
  <title>josdem.io : Refactoring</title>
  <link rel="icon" type="image/png" href="../../jmetadata-16px.png"/>

  <meta name="description" content="Refactoring Duplicated code">
  <meta name="author" content="josdem">
  <meta name="keywords" content="Refactor,Refactoring,josdem,Duplicated code">
  <meta charset="UTF-8">
</head>

<body>
<h1>Duplicated code</h1>
<p>Number one in the stink parade is duplicated code. If you see the same code structure in more than one place, you can be sure that your program will be better if you find a way to unify them.<br/><br/>
 <i>When coding I focus mostly on duplication. When the same thing is done over and over, its a sign that there is an idea in our mind that si no well represented in the code. I try to figure out what it is, then I try to express that idea more clearly.
- Ron Jeffries</i>
</p>

<li>When you have the same expression in two methods of the same class. (Extract method)</li>
<li>When you have the same expression in two sibling subclasses. (Pull up method)</li>
<li>If the code is similar but not the same. (Form template method)
<li>If the methods do the same thing with different algorithm. (Substitute Algorithm)</li>
<li>If you have duplicated code in two unrelated classes. (Extract class)</li>
<br/>
I will show you an example of the first case (Extract Method).<br/>
Consider the following snippet of code.
<br/><br/>
<code>
<span style="color: #646464;">@Test</span><br/>
<span style="color: #7F0055; font-weight: bold;">public void </span>shouldFullAParkingLot()<span style="color: #7F0055; font-weight: bold;"> throws</span> Exception { <br/>
&nbsp;&nbsp;<i>assertFalse</i>(<span style="color: #0000C0;">parkingLot</span>.isFull());<br/>
&nbsp;&nbsp;<span style="color: #7F0055;font-weight: bold;">for</span>(<span style="color: #7F0055; font-weight: bold;">int</span><span style="color: #646464;">i</span>=0;<span style="color: #646464;">i</span><<span style="color: #0000C0;font-weight: bold;">MAX_CAPACITY</span>;<span style="color: #646464;">i</span>++){<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000C0;">parkingLot</span>.park();<br/>
&nbsp;&nbsp;}<br/>
}
</code>
<br/><br/>
<code>
<span style="color: #646464;">@Test</span>(expected=ParkingLotOverFlowException.<span style="color: #7F0055; font-weight: bold;">class</span>)<br/>
<span style="color: #7F0055; font-weight: bold;">public void </span>shouldThrowAnExceptionSinceIsFullAndWantToPark<span style="color: #7F0055; font-weight: bold;"> throws</span> Exception { <br/>
&nbsp;&nbsp;<i>assertFalse</i>(<span style="color: #0000C0;">parkingLot</span>.isFull());<br/>
&nbsp;&nbsp;<span style="color: #7F0055;font-weight: bold;">for</span>(<span style="color: #7F0055; font-weight: bold;">int</span><span style="color: #646464;">i</span>=0;<span style="color: #646464;">i</span><<span style="color: #0000C0;font-weight: bold;">MAX_CAPACITY</span>;<span style="color: #646464;">i</span>++){<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000C0;">parkingLot</span>.park();<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span style="color: #0000C0;">parkingLot</span>.park();<br/>
}
</code>
<br/>
<p>
As you can see the code is almost identical in the two tests, altough they test different scenarios, so we applied extract method in order to avoid duplication.<p/>
<code>
<span style="color: #646464;">@Test</span><br/>
<span style="color: #7F0055; font-weight: bold;">public void </span>shouldFullAParkingLot()<span style="color: #7F0055; font-weight: bold;"> throws</span> Exception { <br/>
&nbsp;&nbsp;fullMyParkingLot();<br/>
}
</code>
<br/><br/>
<code>
<span style="color: #646464;">@Test</span>(expected=ParkingLotOverFlowException.<span style="color: #7F0055; font-weight: bold;">class</span>)<br/>
<span style="color: #7F0055; font-weight: bold;">public void </span>shouldThrowAnExceptionSinceIsFullAndWantToPark<span style="color: #7F0055; font-weight: bold;"> throws</span> Exception { <br/>
&nbsp;&nbsp;fullMyParkingLot();<br/>
&nbsp;&nbsp;<span style="color: #0000C0;">parkingLot</span>.park();<br/>
}
</code>
<br/><br/>
<code>
<span style="color: #7F0055; font-weight: bold;">private void </span>fullMyParkingLot()<span style="color: #7F0055; font-weight: bold;"> throws</span> ParkingLotOverFlowException { <br/>
&nbsp;&nbsp;<i>assertFalse</i>(<span style="color: #0000C0;">parkingLot</span>.isFull());<br/>
&nbsp;&nbsp;<span style="color: #7F0055;font-weight: bold;">for</span>(<span style="color: #7F0055; font-weight: bold;">int</span><span style="color: #646464;">i</span>=0;<span style="color: #646464;">i</span><<span style="color: #0000C0;font-weight: bold;">MAX_CAPACITY</span>;<span style="color: #646464;">i</span>++){<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000C0;">parkingLot</span>.park();<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<i>assertTrue</i>(<span style="color: #0000C0;">parkingLot</span>.isFull());<br/>
}
</code>
<footer>
<!-- TWITTER SHARE BUTTON -->
<a href="https://twitter.com/share" class="twitter-share-button" data-url="http://josdem.io/techtalks/refactoring/duplicated_code.html" data-via="josdem" data-hashtags="Refactoring">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

<!-- GOOGLE PLUS SHARE BUTTON -->
<script src="https://apis.google.com/js/platform.js" async defer></script>
<div class="g-plus" data-action="share" data-height="24"></div>
</footer>
</body>
</html>
